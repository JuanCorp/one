<!DOCTYPE html>
<meta charset="utf-8">
<head>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.6/dc.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    {% load static %}
  <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>
  <script src="{% static 'lib/js/bootstrap.min.js' %}"></script>
  <script src="{% static 'lib/js/crossfilter.js' %}"></script>
  <script src="{% static 'lib/js/keen.min.js' %}"></script>


</head>
<h1>Grafica Test</h1>
<body>
<button id = "Back">Atr√°s</button>
<div id = "region-chart"></div>
<div id = "provincia-chart"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.6/dc.js"></script>
<script>
        var url = "{% url "INFO_Provincias" %}"
</script>




<script>
    queue()
        .defer(d3.json, url)
        .await(makeGraphs);

    function makeGraphs(error,ProvJson) {
        $("#Back").hide();
        $("#provincia-chart").hide();
        var cross = crossfilter(ProvJson);

        //Dimensions
        var regionDim = cross.dimension(function(d){return d["Region"]});
        var provinciaDim = cross.dimension(function(d){return d["Provincia"]});
        var municipioDim = cross.dimension(function(d){return d["Municipio"]});
        var distritoDim = cross.dimension(function(d){return d["Distrito"]});
        var seccionDim = cross.dimension(function(d){return d["Seccion"]});
        var barrioDim = cross.dimension(function(d){return d["Barrio"]});
        var cantidadDim = cross.dimension(function(d){return d["Cantidad"]});

        //Data Groups

        var all = cross.groupAll();
        var byRegion = regionDim.group();
        var byProvincia = provinciaDim.group();
        var byMunicipio = municipioDim.group();
        var byDistrito = distritoDim.group();
        var bySeccion = seccionDim.group();
        var byBarrio = barrioDim.group();

        var totalByRegion = regionDim.group().reduceSum(function(d) {
            return d["Cantidad"];
        });

        var totalByProvincia = provinciaDim.group().reduceSum(function(d) {
            return d["Cantidad"];
        });
        var totalCantidad = cross.groupAll().reduceSum(function(d) {return d["Cantidad"];});

        console.log(totalByRegion);

        // Graficos

        var ByRegionND = dc.rowChart("#region-chart");
        var ByProvincia = dc.rowChart("#provincia-chart");
        /*
        ByRegionND
        .width(600)
        .height(260)
        .margins({top: 10, right: 50, bottom: 30, left: 50})
        .dimension(regionDim)
        .group(totalByRegion)
        .transitionDuration(500)
        .x(d3.scale.ordinal().rangeRoundBands([0, 600], .05).domain(regionDim))
        .xAxisLabel("Region")
        .yAxis().ticks(5);
        */
        ByRegionND
        .width(600)
        .height(550)
        .dimension(regionDim)
        .group(totalByRegion)
        .xAxis().ticks(4);

         ByProvincia
        .width(600)
        .height(550)
        .dimension(provinciaDim)
        .group(totalByProvincia)
        .xAxis().ticks(4);

        ByRegionND.addFilterHandler(function (filters, filter) {
        filters.length = 0; // empty the array
        filters.push(filter);
        $("#region-chart").hide(500);
        provinciaDim.filter(filter);
        $("#provincia-chart").show(500);
        $("#Back").show(100);

        return filters
        });

        $("#Back").click( function (){
            $("#provincia-chart").hide(500);
            $("#region-chart").show(500);
            $("#Back").hide(100);
        });

        dc.renderAll();



    };
</script>
</body>
</html>